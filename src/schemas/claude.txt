import { z } from 'zod'

// System Clock Schema
const SystemClockSchema = z.object({
	CurrentTime: z.string(),
	CurrentTimeWithOffset: z.string(),
})

// Port Schemas for AVIO
const DigitalCecSchema = z.object({
	IsCecErrorDetected: z.boolean(),
	ReceiveCecMessage: z.string(),
})

const DigitalInfoSchema = z.object({
	Cec: DigitalCecSchema,
	ColorDepth: z.string(),
	ColorSpace: z.string(),
	HdcpReceiverCapability: z.string().optional(),
	HdcpState: z.string(),
	IsSourceHdcpActive: z.boolean().optional(),
	SourceContentStreamType: z.string().optional(),
	SourceHdcp: z.string().optional(),
	Status3D: z.string(),
	HdcpSinkCapability: z.string().optional(),
	HdcpTransmitterMode: z.string().optional(),
	IsBlankingEnabled: z.boolean().optional(),
	IsOutputDisabled: z.boolean().optional(),
	IsTransmitting: z.boolean().optional(),
	DownstreamEdid: z
		.object({
			Manufacturer: z.string(),
			Name: z.string(),
			PrefTiming: z.string(),
			SerialNumber: z.string(),
		})
		.optional(),
})

const AudioDigitalSchema = z.object({
	Channels: z.number(),
	Format: z.string(),
	SamplingFrequency: z.number().optional(),
})

const AudioSchema = z.object({
	Digital: AudioDigitalSchema.optional(),
	Mute: z.boolean().optional(),
	Stereo: z.boolean().optional(),
	Volume: z.number().optional(),
})

const PortSchema = z.object({
	AspectRatio: z.string(),
	Audio: AudioSchema,
	CurrentEdid: z.string().optional(),
	CurrentEdidType: z.string().optional(),
	CurrentResolution: z.string(),
	Digital: DigitalInfoSchema,
	EdidApplyError: z.string().optional(),
	FramesPerSecond: z.number(),
	HorizontalResolution: z.number(),
	IsInterlacedDetected: z.boolean(),
	IsSourceDetected: z.boolean().optional(),
	IsSyncDetected: z.boolean().optional(),
	IsSinkConnected: z.boolean().optional(),
	PortType: z.string(),
	Priority: z.number().optional(),
	VerticalResolution: z.number(),
	ColorDepth: z.string().optional(),
	ColorSpace: z.string().optional(),
	ColorSpaceMode: z.string().optional(),
	MaxColorDepth: z.string().optional(),
})

const InputInfoSchema = z.object({
	Id: z.string(),
	Ports: z.record(z.string(), PortSchema),
	Version: z.string(),
})

const OutputInfoSchema = z.object({
	Id: z.string().optional(),
	Ports: z.record(z.string(), PortSchema),
	Version: z.string().optional(),
})

const CapabilitiesSchema = z.object({
	IsAudioRoutingSupported: z.boolean(),
	IsStreamRoutingSupported: z.boolean(),
	IsUsbRoutingSupported: z.boolean(),
	IsVideoRoutingSupported: z.boolean(),
})

const InputSchema = z.object({
	Capabilities: CapabilitiesSchema,
	InputInfo: InputInfoSchema,
	UserSpecifiedName: z.string(),
})

const OutputSchema = z.object({
	Capabilities: CapabilitiesSchema,
	Id: z.string(),
	OutputInfo: OutputInfoSchema,
	UserSpecifiedName: z.string(),
})

// Authentication Schema
const LocalGroupSchema = z.object({
	AccessLevel: z.string(),
	Name: z.string(),
})

const LocalUserSchema = z.object({
	AccessLevel: z.string(),
	LocalGroups: z.array(z.string()),
	Name: z.string(),
})

const CurrentUserSchema = z.object({
	AccessLevel: z.string(),
	IsActiveDirectoryUser: z.boolean(),
	LocalGroups: z.array(z.string()),
	Name: z.string(),
})

const AuthenticationStateSchema = z.object({
	AdminPassword: z.string(),
	AdminUsername: z.string(),
	IsEnabled: z.boolean(),
})

const AuthenticationSchema = z.object({
	ActiveDirectoryGroups: z.record(z.string(), z.unknown()),
	AuthenticationState: AuthenticationStateSchema,
	CurrentUser: CurrentUserSchema,
	IsEndUserPageEnabled: z.boolean(),
	IsForceAuthEnabled: z.boolean(),
	IsUserAuthEnabled: z.boolean(),
	LocalGroups: z.record(z.string(), LocalGroupSchema),
	LocalUsers: z.record(z.string(), LocalUserSchema),
	SslMode: z.string(),
	Version: z.string(),
})

// Certificate Schema
const CertificateSchema = z.object({
	Expiration: z.string(),
	IsIeee8021xInUse: z.number(),
	IsSipInUse: z.number(),
	IsStreamInUse: z.number(),
	IsWebsocketInUse: z.number(),
	Name: z.string(),
	StartDate: z.string(),
	Uuid: z.string(),
})

const CertificateStoreTypeSchema = z.object({
	Certificates: z.record(z.string(), CertificateSchema),
	IsCsrSupported: z.boolean(),
	MaxEntries: z.number(),
})

const CertificateStoreSchema = z.object({
	Intermediate: CertificateStoreTypeSchema,
	Machine: CertificateStoreTypeSchema,
	Ocsp: z.object({
		IsSupported: z.boolean(),
	}),
	Root: CertificateStoreTypeSchema,
	Sip: CertificateStoreTypeSchema,
	StoresSupportedOptions: z.string(),
	StoresSupportedVersion: z.string(),
	Stream: CertificateStoreTypeSchema,
	Version: z.string(),
	WebServer: CertificateStoreTypeSchema,
	Websocket: CertificateStoreTypeSchema,
})

// Network Schema
const IPv4AddressSchema = z.object({
	Address: z.string(),
	SubnetMask: z.string(),
})

const IPv4Schema = z.object({
	Addresses: z.array(IPv4AddressSchema),
	DefaultGateway: z.string(),
	DnsServers: z.array(z.string()),
	IsDhcpEnabled: z.boolean(),
	StaticAddresses: z.array(IPv4AddressSchema),
	StaticDefaultGateway: z.string(),
	StaticDns: z.array(z.string()),
})

const NetworkAdapterSchema = z.object({
	AddressSchema: z.string(),
	IPv4: IPv4Schema,
	InternalName: z.string(),
	IsAdapterEnabled: z.boolean(),
	LinkStatus: z.boolean(),
	MacAddress: z.string(),
	Name: z.string(),
	Type: z.string(),
})

const EthernetSchema = z.object({
	Adapters: z.array(NetworkAdapterSchema),
	AutoNegotiationEnabled: z.boolean(),
	DomainName: z.string(),
	HostName: z.string(),
	IgmpVersion: z.string(),
	IsIcmpPingEnabled: z.boolean(),
	IsSshEnabled: z.boolean(),
	Version: z.string(),
})

// Device Info Schema
const DeviceInfoSchema = z.object({
	BuildDate: z.string(),
	Category: z.string(),
	DeviceId: z.string(),
	DeviceVersion: z.string(),
	Devicekey: z.string(),
	MacAddress: z.string(),
	Manufacturer: z.string(),
	Model: z.string(),
	Name: z.string(),
	PufVersion: z.string(),
	RebootReason: z.string(),
	SerialNumber: z.string(),
	Version: z.string(),
})

// Driver Management Schema
const SupportedInputSchema = z.object({
	Name: z.string(),
	Type: z.string(),
})

const VideoDisplaySchema = z.object({
	SupportedInputs: z.record(z.string(), SupportedInputSchema),
})

const DriverMetadataSchema = z.object({
	adjustableBaud: z.boolean(),
	adjustableCommunicationId: z.boolean(),
	adjustableCooldownTimer: z.boolean(),
	adjustableDataBits: z.boolean(),
	adjustableHardwareHandshaking: z.boolean(),
	adjustableParity: z.boolean(),
	adjustablePort: z.boolean(),
	adjustableSoftwareHandshaking: z.boolean(),
	adjustableStopBits: z.boolean(),
	adjustableWarmupTimer: z.boolean(),
	cooldownTime: z.number(),
	warmupTime: z.number(),
})

const CommunicationSchema = z.object({
	type: z.string(),
})

const DriverPortalInfoSchema = z.object({
	authentications: z.array(z.unknown()),
	communication: CommunicationSchema,
	driverMetadata: z.array(DriverMetadataSchema),
	userAttributes: z.array(z.unknown()),
})

const DriverSchema = z.object({
	DriverId: z.string(),
	DriverPortalInfo: DriverPortalInfoSchema,
	DriverType: z.string(),
	DriverVersion: z.string(),
	InterfaceType: z.string(),
	IsAuthenticationRequired: z.boolean(),
	IsCrestronDriver: z.boolean(),
	IsCustomActiveDriver: z.boolean(),
	LocalDriverLocation: z.string(),
	Manufacturer: z.string(),
	MappedId: z.string(),
	Name: z.array(z.string()),
	VideoDisplay: VideoDisplaySchema.optional(),
})

const DriverMgmntSchema = z.object({
	Drivers: z.record(z.string(), DriverSchema),
	SystemDrivers: z.record(z.string(), DriverSchema),
	Version: z.string(),
	allowedSdkVersion: z.number(),
})

// EDID Management Schema
const EdidEntrySchema = z.object({
	FileName: z.string(),
	Name: z.string(),
})

const EdidMgmntSchema = z.object({
	CopyEdidList: z.record(
		z.string(),
		z.object({
			Name: z.string(),
		}),
	),
	SystemEdidList: z.record(z.string(), EdidEntrySchema),
	Version: z.string(),
})

// Auto Power Config Schema
const CecCommandSchema = z.object({
	Format: z.string(),
	IsCustomCmd: z.boolean(),
	Terminator: z.string(),
	TransmitData: z.string(),
})

const CecPortSchema = z.object({
	Cmds: z.object({
		InputControl: CecCommandSchema,
		PowerOff: CecCommandSchema,
		PowerOn: CecCommandSchema,
	}),
	CmdsSupported: z.array(z.string()),
})

const OutputPortConfigSchema = z.object({
	CcdDeviceKey: z.string(),
	CurrentInterfacePort: z.string(),
	CurrentInterfaceType: z.string(),
	CustomCommandFormat: z.string(),
	CustomCommandTerminator: z.string(),
	InputControl: z.object({
		DelayInSec: z.number(),
		IsEnabled: z.boolean(),
	}),
	IsCustomTimeout: z.boolean(),
	IsEnabled: z.boolean(),
	IsTurnOffOutputEnabled: z.boolean(),
	OutputTimeoutSeconds: z.number(),
	Trigger: z.string(),
})

const AutoPowerOutputSchema = z.object({
	OccupancyStatus: z.string(),
	Ports: z.record(z.string(), OutputPortConfigSchema),
})

const AutoPowerConfigSchema = z.object({
	Cec: z.object({
		Ports: z.record(z.string(), CecPortSchema),
		PortsSupported: z.array(z.string()),
	}),
	Outputs: z.record(z.string(), AutoPowerOutputSchema),
	Version: z.string(),
})

// Routing Schemas
const RoutePrioritySchema = z.object({
	PrioirtyList: z.record(z.string(), z.number()),
})

const RouteSchema = z.object({
	AudioSource: z.string(),
	VideoSource: z.string(),
})

const AvMatrixRoutingSchema = z.object({
	IsAutomaticRoutingEnabled: z.boolean(),
	IsPriorityRoutingEnabled: z.boolean(),
	RoutePriorities: z.record(z.string(), RoutePrioritySchema),
	Routes: z.record(z.string(), RouteSchema),
	SyncDetectedOrder: z.string(),
	Version: z.string(),
})

// Main Device Schema
const DeviceSchema = z.object({
	SystemClock: SystemClockSchema,
	Authentication: AuthenticationSchema,
	AutoPowerConfig: AutoPowerConfigSchema,
	AutoUpdateMaster: z.object({
		AutoUpdateSchedule: z.object({
			CheckInterval: z.number(),
			DayOfWeek: z.string(),
			TimeOfDay: z.string(),
		}),
		AutoUpdateStatus: z.object({
			AutoUpdateState: z.string(),
			AutoUpdateStateId: z.number(),
		}),
		IsCustomUrlEnabled: z.boolean(),
		IsEnabled: z.boolean(),
		ManifestPath: z.string(),
		ServerCredentials: z.object({
			Username: z.string(),
		}),
		Version: z.string(),
	}),
	AvMatrixRouting: AvMatrixRoutingSchema,
	AvMatrixRoutingV2: AvMatrixRoutingSchema,
	AvioV2: z.object({
		GlobalConfig: z.object({
			GlobalEdid: z.string(),
			GlobalEdidType: z.string(),
		}),
		Inputs: z.record(z.string(), InputSchema),
		Outputs: z.record(z.string(), OutputSchema),
		Version: z.string(),
	}),
	CcdConfig: z.null(),
	CertificateStore: CertificateStoreSchema,
	CloudSettings: z.object({
		FusionCloud: z.record(z.string(), z.unknown()),
		Version: z.string(),
		XioCloud: z.object({
			IsEnabled: z.boolean(),
			IsXioCloudClaimed: z.boolean(),
		}),
	}),
	ConnectedDevices: z.object({
		CcdDevices: z.record(z.string(), z.unknown()),
		Version: z.string(),
	}),
	ControlPorts: z.object({
		Version: z.string(),
	}),
	DeviceCapabilities: z.object({
		IsConfigFileUploadSupported: z.boolean(),
		IsLogFileUploadSupported: z.boolean(),
		PortConfig: z.object({
			NumberOfDmInputs: z.number(),
			NumberOfEthernetAdapters: z.number(),
			NumberOfHdmiInputs: z.number(),
			NumberOfHdmiOutputs: z.number(),
		}),
		Version: z.string(),
	}),
	DeviceConfiguration: z.object({
		DownloadedFile: z.string(),
		DownloadedFilePath: z.string(),
		Interface: z.string(),
		Operation: z.string(),
		UploadedFile: z.string(),
		UploadedFilePath: z.string(),
		Version: z.string(),
	}),
	DeviceInfo: DeviceInfoSchema,
	DeviceOperations: z.object({
		FirmwareUpgrade: z.string(),
		ProjectType: z.string(),
		SystemUpgrade: z.object({
			TotalWaitingTime: z.number(),
		}),
		UpgradeStatus: z.string(),
		Version: z.string(),
	}),
	DriverMgmnt: DriverMgmntSchema,
	EdidMgmnt: EdidMgmntSchema,
	Ethernet: EthernetSchema,
	FilePaths: z.object({
		Certificate: z.record(z.string(), z.string()),
		DeviceConfig: z.record(z.string(), z.string()),
		Driver: z.record(z.string(), z.string()),
		Edid: z.record(z.string(), z.string()),
		Firmware: z.record(z.string(), z.string()),
		Version: z.string(),
	}),
	Ieee8021x: z.object({
		AuthenticationMethod: z.string(),
		Domain: z.string(),
		IsEnabled: z.boolean(),
		IsServerValidationEnabled: z.boolean(),
		MachineCertificateName: z.string(),
		Ocsp: z.object({
			IsSupported: z.boolean(),
		}),
		Password: z.string(),
		TrustedCertifyingAuthorities: z.object({
			Certificates: z.record(
				z.string(),
				z.object({
					Name: z.string(),
					Trusted: z.boolean(),
					Uuid: z.string(),
				}),
			),
		}),
		UserName: z.string(),
		Version: z.string(),
	}),
	IpTable: z.object({
		EncryptConnection: z.boolean(),
		Entries: z.record(z.string(), z.unknown()),
		EntriesCurrentKeyList: z.array(z.unknown()),
		IsReadOnly: z.boolean(),
		MaxEntries: z.number(),
		Password: z.string(),
		Username: z.string(),
		Version: z.string(),
	}),
	IpTableV2: z.object({
		EncryptConnection: z.boolean(),
		Entries: z.record(z.string(), z.unknown()),
		EntriesCurrentKeyList: z.array(z.unknown()),
		IsReadOnly: z.boolean(),
		MaxEntries: z.number(),
		Password: z.string(),
		Username: z.string(),
		Version: z.string(),
	}),
	NetworkAdapters: z.object({
		Adapters: z.record(z.string(), NetworkAdapterSchema),
		DnsSettings: z.object({
			IPv4: z.object({
				DnsServers: z.array(z.string()),
				StaticDns: z.array(z.string()),
			}),
		}),
		HostName: z.string(),
		IgmpVersion: z.string(),
		IsIcmpPingEnabled: z.boolean(),
		Version: z.string(),
	}),
	ObjectVersions: z.record(z.string(), z.string()),
	PeripheralControl: z.object({
		IsFrontPanelLedsEnabled: z.boolean(),
		IsFrontPanelLockoutEnabled: z.boolean(),
		IsUsbServicePortEnabled: z.boolean(),
		Version: z.string(),
	}),
	RemoteWebConnectionV2: z.object({
		Version: z.string(),
	}),
	Security: z.object({
		CsrMatchesCert: z.boolean(),
		Gateway: z.object({
			Mode: z.string(),
			ModeSupportedVersion: z.string(),
			ModesSupportedOptions: z.string(),
		}),
		IsCsrAvailable: z.boolean(),
		IsCsrSupported: z.boolean(),
		Ssl: z.object({
			CertificatesSupportedOptions: z.string(),
			CertificatesSupportedVersion: z.string(),
			Mode: z.string(),
			ModeSupportedOptions: z.string(),
			ModeSupportedVersion: z.string(),
			Tls: z.string(),
			TlsSupportedOptions: z.string(),
			TlsSupportedVersion: z.string(),
		}),
		VerificationOptions: z.object({
			Client: z.object({
				HostNameMatchesURL: z.number(),
				ServerAuthenticationEnabled: z.number(),
				TrustServerCertificate: z.number(),
			}),
			ServerCertificate: z.object({
				ServerAuthenticationEnabled: z.number(),
			}),
			TrustedCertificate: z.object({
				CASigned: z.number(),
				TrustedAuthoritySigned: z.number(),
			}),
		}),
		Version: z.string(),
	}),
	SourceSelectionConfiguration: z.null(),
	SystemClock: z.object({
		CurrentTime: z.string(),
		CurrentTimeWithOffset: z.string(),
		DaylightSavingsEnabled: z.boolean(),
		Ntp: z.object({
			IsEnabled: z.boolean(),
			Servers: z.record(
				z.object({
					Address: z.string(),
					AuthKey: z.string(),
					AuthKeyId: z.number(),
					AuthMethod: z.string(),
					Port: z.number(),
				}),
			),
			ServersCurrentKeyList: z.array(z.string()),
		}),
		Sntp: z.object({
			IsEnabled: z.boolean(),
			SntpServer: z.string(),
		}),
		TimeZone: z.string(),
		TimeZoneOptionsName: z.string(),
		TimeZoneOptionsVersion: z.string(),
		Version: z.string(),
	}),
	SystemVersions: z.object({
		Components: z.array(
			z.object({
				Category: z.string(),
				Name: z.string(),
				SubComponents: z.array(z.unknown()),
				Version: z.string(),
			}),
		),
		Version: z.string(),
	}),
	UserInterfaceConfig: z.object({
		DeviceSupport: z.object({
			TimeZones: z.record(z.string()),
		}),
		Version: z.string(),
	}),
	Version: z.string(),
})

// Top-level WebSocket Message Schema
export const WebSocketMessageSchema = z.object({
	Device: DeviceSchema,
})

// Type exports
export type WebSocketMessage = z.infer<typeof WebSocketMessageSchema>
export type DeviceData = z.infer<typeof DeviceSchema>
export type NetworkAdapter = z.infer<typeof NetworkAdapterSchema>
export type Driver = z.infer<typeof DriverSchema>
export type Certificate = z.infer<typeof CertificateSchema>

// Example usage:
// const result = WebSocketMessageSchema.safeParse(jsonData);
// if (result.success) {
//   console.log('Valid data:', result.data);
// } else {
//   console.error('Validation errors:', result.error);
// }
